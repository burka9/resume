---
import ThemeToggle from "./ThemeToggle.astro";

const navLinks = [
  { href: "/", label: "Home" },
  { href: "/about", label: "About" },
  { href: "/projects", label: "Projects" },
  { href: "/portfolio", label: "Portfolio" },
  { href: "/contact", label: "Contact" },
];

const currentPath = Astro.url.pathname;
---

<header
  class="fixed top-0 left-0 right-0 z-50 backdrop-blur-md border-b border-[var(--color-border)] transition-colors"
  style="background-color: rgba(var(--color-background-rgb), 0.8);"
>
  <nav class="container flex items-center justify-between h-16">
    <a href="/" class="text-xl font-bold text-accent">BE</a>

    <!-- Desktop Navigation -->
    <div class="hidden md:flex items-center gap-8">
      <ul class="flex items-center gap-8">
        {
          navLinks.map((link) => (
            <li>
              <a
                href={link.href}
                class={`text-sm font-medium transition-colors ${
                  currentPath === link.href
                    ? "text-accent"
                    : "text-text-secondary hover:text-text-primary"
                }`}
              >
                {link.label}
              </a>
            </li>
          ))
        }
      </ul>
      <ThemeToggle />
    </div>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-btn"
      class="md:hidden p-2 text-text-secondary hover:text-text-primary"
      aria-label="Toggle menu"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
  </nav>

  <!-- Mobile Navigation -->
  <div
    id="mobile-menu"
    class="hidden md:hidden border-t border-[var(--color-border)]"
  >
    <ul class="container py-4 space-y-4">
      {
        navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class={`block text-sm font-medium transition-colors ${
                currentPath === link.href
                  ? "text-accent"
                  : "text-text-secondary hover:text-text-primary"
              }`}
            >
              {link.label}
            </a>
          </li>
        ))
      }
      <li class="pt-2 border-t border-[var(--color-border)]">
        <div class="flex items-center justify-between">
          <span class="text-sm font-medium text-text-secondary">Theme</span>
          <ThemeToggle />
        </div>
      </li>
    </ul>
  </div>
</header>

<script>
  function setupMobileMenu() {
    const btn = document.getElementById("mobile-menu-btn");
    const menu = document.getElementById("mobile-menu");
    const links = menu?.querySelectorAll("a");

    // Toggle menu
    function toggleMenu() {
      menu?.classList.toggle("hidden");
    }

    // Close menu
    function closeMenu() {
      menu?.classList.add("hidden");
    }

    // Clean up old listeners
    btn?.removeEventListener("click", toggleMenu);

    // Add new listeners
    btn?.addEventListener("click", toggleMenu);

    // Close menu when a link is clicked
    links?.forEach((link) => {
      link.removeEventListener("click", closeMenu);
      link.addEventListener("click", closeMenu);
    });
  }

  document.addEventListener("astro:page-load", setupMobileMenu);
</script>
